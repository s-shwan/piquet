<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piquet: Pure Hotseat Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --felt-green: #35654d;
            --felt-dark: #1e3f2b;
            --gold: #d4af37;
            --gold-light: #f3e5ab;
            --miss-red: #cc0000; /* Deep Red for Dedication */
            --card-w: 90px;
            --card-h: 130px;
        }
        * { box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background: radial-gradient(circle at center, var(--felt-green), var(--felt-dark));
            color: #fff;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- DEDICATION STYLING --- */
        #dedication-line {
            font-family: 'Great Vibes', cursive; /* Elegant Script Font */
            font-size: 2.5rem;
            color: var(--miss-red);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7), 0 0 10px var(--miss-red);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        /* --- TYPOGRAPHY --- */
        h1 {
            font-family: 'Playfair Display', serif;
            color: var(--gold);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
            margin: 0 0 10px 0;
            font-size: 3rem;
            letter-spacing: 1px;
        }

        /* --- HUD --- */
        .hud-container {
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 25px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            border-bottom: 2px solid var(--gold);
        }
        .score-box { font-size: 1.2rem; font-weight: 700; }
        .score-box span { color: var(--gold); margin-left: 5px; font-size: 1.4rem; }
        #phase-indicator {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--gold-light);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- GAME AREA --- */
        #game-area {
            position: relative;
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- TABLE / TRICK AREA & TALONS --- */
        #table-center {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
        }
        #trick-area {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 180px;
            flex-grow: 1;
            margin: 0 20px;
            border: 2px dashed rgba(212, 175, 55, 0.3);
            border-radius: 16px;
            background: rgba(0,0,0,0.1);
        }
        .trick-slot {
            width: var(--card-w);
            height: var(--card-h);
            margin: 0 20px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.05); 
        }

        /* --- TALON PILES --- */
        .talon-pile {
            width: 60px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--gold);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--gold-light);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            position: relative;
        }
        .talon-pile::after {
            content: 'DISCARDS';
            position: absolute;
            bottom: -20px;
            font-size: 0.7rem;
            font-weight: 400;
            opacity: 0.7;
        }
        .talon-pile.empty {
            background: rgba(255, 255, 255, 0.05);
            border-style: dashed;
            color: rgba(255, 255, 255, 0.3);
        }
        
        /* --- HAND AREA --- */
        .hand-container {
            min-height: 160px;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: -10px;
            padding: 10px;
            transition: opacity 0.3s;
        }
        
        /* --- CARD STYLING --- */
        .card {
            width: var(--card-w);
            height: var(--card-h);
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px;
            margin: 5px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            color: #333;
        }
        .card:hover:not(.disabled) {
            transform: translateY(-15px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            z-index: 10;
        }
        .card.selected {
            transform: translateY(-20px);
            box-shadow: 0 0 0 3px var(--gold);
            z-index: 5;
        }
        .card.disabled {
            opacity: 0.6;
            filter: grayscale(80%);
            cursor: not-allowed;
        }
        .rank { font-weight: 900; font-size: 1.2rem; line-height: 1; }
        .suit { font-size: 1.8rem; align-self: flex-end; line-height: 1; }
        .center-suit { 
            position: absolute; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 2.5rem; 
            opacity: 0.15; 
        }
        .hearts, .diamonds { color: #d32f2f; }
        .clubs, .spades { color: #212121; }

        /* --- CONTROLS --- */
        .controls-area {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            background: linear-gradient(to bottom, #f3e5ab, #d4af37);
            border: 1px solid #b8860b;
            border-radius: 6px;
            padding: 12px 30px;
            color: #3e2723;
            font-family: 'Lato', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            box-shadow: 0 4px 0 #8b6914, 0 5px 10px rgba(0,0,0,0.3);
            transition: all 0.1s;
        }
        button:hover { filter: brightness(1.1); transform: translateY(-1px); }
        button:active { transform: translateY(4px); box-shadow: 0 0 0 #8b6914, inset 0 2px 5px rgba(0,0,0,0.2); }
        
        /* --- TRANSITION OVERLAY --- */
        #transition-overlay {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(30, 63, 43, 0.98); /* Opaque green to hide cards */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            z-index: 100;
            border-radius: 20px;
            border: 2px solid var(--gold);
        }
        #transition-overlay h2 { color: var(--gold-light); margin-bottom: 20px; font-size: 2rem; }
        #transition-overlay p { font-size: 1.2rem; margin-bottom: 30px; color: #fff; }

        /* --- NOTIFICATIONS --- */
        #notification-banner {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid var(--gold);
            padding: 15px 40px;
            border-radius: 0 0 10px 10px;
            text-align: center;
            z-index: 200;
            transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        #notification-banner.show { top: 0; }
        #notif-text { font-size: 1.1rem; color: #fff; }

        /* --- RESPONSIVE --- */
        @media (max-width: 600px) {
            :root { --card-w: 60px; --card-h: 90px; }
            #dedication-line { font-size: 1.8rem; }
            h1 { font-size: 2rem; }
            .hud-container { flex-direction: column; gap: 10px; }
            #table-center { flex-direction: column; }
            #trick-area { margin: 10px 0; }
            .talon-pile { margin: 10px 0; }
        }
    </style>
</head>
<body>

    <div id="notification-banner"><div id="notif-text">Welcome</div></div>
    
    <div id="dedication-line">For Miss Red</div>

    <h1>Piquet: Pure Hotseat Edition</h1>

    <div class="hud-container">
        <div class="score-box">P1: <span id="score-p1">0</span></div>
        <div id="phase-indicator">Setup</div>
        <div class="score-box">P2: <span id="score-p2">0</span></div>
    </div>

    <div id="game-area">
        
        <div id="table-center">
             <div class="talon-pile" id="talon-p1">0</div>

            <div id="trick-area">
                <div class="trick-slot" id="slot-p1"></div>
                <div class="trick-slot" id="slot-p2"></div>
            </div>

             <div class="talon-pile" id="talon-p2">0</div>
        </div>


        <div id="hand-display" class="hand-container">
            <p style="opacity: 0.7; font-style: italic;">Click Start New Game</p>
        </div>

        <div id="transition-overlay">
            <h2>Pass the Device</h2>
            <p>Pass device to <span id="next-player-name" style="color:var(--gold); font-weight:bold;">Player 2</span></p>
            <button class="btn-large" id="reveal-btn">I am Ready - Reveal Hand</button>
        </div>

        <div class="controls-area">
            <button id="start-2p-btn" class="btn-large">Start New Game (2 Players)</button>
            <button id="ecarte-btn" style="display:none;">Discard Selected</button>
            <button id="declare-btn" style="display:none;">Declare Score</button>
        </div>
    </div>

    <script>
        /* --- CONFIG --- */
        const SUITS = ['Spades', 'Hearts', 'Clubs', 'Diamonds'];
        const RANKS = ['7', '8', '9', '10', 'Jack', 'Queen', 'King', 'Ace'];
        const VALUES = {'7':7, '8':8, '9':9, '10':10, 'Jack':11, 'Queen':12, 'King':13, 'Ace':14};
        
        /* --- UI HELPERS --- */
        const UI = {
            banner: document.getElementById('notification-banner'),
            notifText: document.getElementById('notif-text'),
            p1Score: document.getElementById('score-p1'),
            p2Score: document.getElementById('score-p2'),
            phase: document.getElementById('phase-indicator'),
            hand: document.getElementById('hand-display'),
            slotP1: document.getElementById('slot-p1'),
            slotP2: document.getElementById('slot-p2'),
            talonP1: document.getElementById('talon-p1'),
            talonP2: document.getElementById('talon-p2'),
            overlay: document.getElementById('transition-overlay'),
            nextName: document.getElementById('next-player-name'),
            btns: {
                start2p: document.getElementById('start-2p-btn'),
                ecarte: document.getElementById('ecarte-btn'),
                declare: document.getElementById('declare-btn'),
                reveal: document.getElementById('reveal-btn')
            }
        };

        /* --- GAME LOGIC --- */
        class Card {
            constructor(suit, rank) {
                this.suit = suit;
                this.rank = rank;
                this.val = VALUES[rank];
            }
        }

        class Player {
            constructor(name) {
                this.name = name;
                this.hand = [];
                this.score = 0;
                this.discards = 0; // Tracks number of cards discarded
            }
            sortHand() {
                this.hand.sort((a,b) => {
                    if (a.suit !== b.suit) return a.suit.localeCompare(b.suit);
                    return b.val - a.val;
                });
            }
            calcPoints() {
                let pts = 0;
                this.hand.forEach(c => { if (c.val >= 10) pts += 1; });
                return pts;
            }
            getPlayable(leadSuit) {
                if (!leadSuit) return this.hand;
                const following = this.hand.filter(c => c.suit === leadSuit);
                return following.length > 0 ? following : this.hand;
            }
        }

        class Game {
            constructor() {
                this.p1 = new Player("Player 1");
                this.p2 = new Player("Player 2");
                this.deck = [];
                this.talon = [];
                this.turn = 0; // 0=p1, 1=p2
                this.phase = 'setup'; 
                this.trickCards = []; 
                this.roundTricks = [0, 0];
                this.savedPhase = null; 
            }

            notify(msg) {
                UI.notifText.innerText = msg;
                UI.banner.classList.add('show');
                setTimeout(() => UI.banner.classList.remove('show'), 3000);
            }

            // --- CORE FLOW ---

            deal() {
                this.initDeck();
                this.p1.hand = this.deck.splice(0, 12);
                this.p2.hand = this.deck.splice(0, 12);
                this.p1.sortHand();
                this.p2.sortHand();
                this.talon = this.deck;
                
                this.phase = 'ecarte';
                this.turn = 0; // Elder starts
                this.updateView();
                this.notify("Elder Hand (P1): Select discards (max 5).");
            }

            initDeck() {
                this.deck = [];
                SUITS.forEach(s => RANKS.forEach(r => this.deck.push(new Card(s, r))));
                for (let i = this.deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
                }
            }

            // --- TRANSITION SYSTEM ---

            // Call this whenever the active player changes
            passTurn(nextPlayerIdx, nextPhaseName) {
                this.turn = nextPlayerIdx;
                this.savedPhase = nextPhaseName;
                
                // Show Overlay
                this.phase = 'transition';
                this.updateView();
            }

            confirmReveal() {
                // Restore state
                this.phase = this.savedPhase;
                this.updateView();
            }

            // --- ECARTE PHASE ---

            discard(indices) {
                const p = this.turn === 0 ? this.p1 : this.p2;
                const maxDraw = this.turn === 0 ? 5 : Math.min(this.talon.length, 5);

                if (indices.length > maxDraw) {
                    this.notify(`Max discards: ${maxDraw}`);
                    return;
                }

                // Discard
                const keep = p.hand.filter((_, i) => !indices.includes(i));
                p.discards += indices.length;

                // Draw
                const draw = this.talon.splice(0, indices.length);
                p.hand = [...keep, ...draw];
                p.sortHand();

                // Logic to switch turns
                if (this.turn === 0) {
                    // P1 done -> P2's turn to discard
                    this.passTurn(1, 'ecarte');
                    this.notify("Pass to Player 2 for Discard (max " + Math.min(this.talon.length, 5) + ").");
                } else {
                    // P2 done -> P1's turn to Declare/Lead
                    this.declare(); 
                }
                this.updateView();
            }

            // --- DECLARE / TRICK PREP ---

            declare() {
                // Auto-calc points for demo
                const p1Pts = this.p1.calcPoints();
                const p2Pts = this.p2.calcPoints();
                this.p1.score += p1Pts;
                this.p2.score += p2Pts;
                this.notify(`Points declared: P1 +${p1Pts}, P2 +${p2Pts}`);

                // P1 always leads first trick
                this.passTurn(0, 'trick');
                this.trickCards = [];
            }

            // --- TRICK PHASE ---

            playCard(index) {
                const p = this.turn === 0 ? this.p1 : this.p2;
                const card = p.hand[index];

                // Validation
                if (this.trickCards.length === 1) {
                    const lead = this.trickCards[0].card;
                    const hasSuit = p.hand.some(c => c.suit === lead.suit);
                    if (hasSuit && card.suit !== lead.suit) {
                        this.notify(`Follow suit: ${lead.suit}`);
                        return;
                    }
                }

                // Execute Play
                p.hand.splice(index, 1);
                this.trickCards.push({ player: this.turn, card: card });
                
                // Render table immediately
                const slot = this.turn === 0 ? UI.slotP1 : UI.slotP2;
                slot.innerHTML = '';
                slot.appendChild(renderCard(card));
                this.updateView();

                // Flow Control
                if (this.trickCards.length === 1) {
                    // Trick ongoing, pass to next player to complete trick
                    const nextP = 1 - this.turn;
                    this.passTurn(nextP, 'trick');
                } else {
                    // Trick complete (2 cards)
                    setTimeout(() => this.resolveTrick(), 1500);
                }
            }

            resolveTrick() {
                const c1 = this.trickCards[0];
                const c2 = this.trickCards[1];
                let winnerIdx = c1.player;

                if (c2.card.suit === c1.card.suit && c2.card.val > c1.card.val) {
                    winnerIdx = c2.player;
                }

                // Update scores
                if (winnerIdx === 0) { this.p1.score++; this.roundTricks[0]++; }
                else { this.p2.score++; this.roundTricks[1]++; }

                this.notify(`Trick winner: ${winnerIdx===0?'Player 1':'Player 2'}`);

                // Clean up
                this.trickCards = [];
                UI.slotP1.innerHTML = '';
                UI.slotP2.innerHTML = '';

                // Check Round End
                if (this.p1.hand.length === 0 && this.p2.hand.length === 0) {
                    this.endRound();
                    return;
                }

                // Set up next trick lead (winner leads)
                this.passTurn(winnerIdx, 'trick');
            }

            endRound() {
                // Bonus
                if (this.roundTricks[0] > this.roundTricks[1]) this.p1.score += 10;
                else if (this.roundTricks[1] > this.roundTricks[0]) this.p2.score += 10;
                
                this.phase = 'setup';
                this.updateView();
                alert(`Round Over!\nP1: ${this.p1.score}\nP2: ${this.p2.score}`);
            }

            /* --- RENDERER --- */
            updateView() {
                // Scores & Phase
                UI.p1Score.innerText = this.p1.score;
                UI.p2Score.innerText = this.p2.score;
                UI.phase.innerText = this.phase === 'transition' ? 'PASS DEVICE' : this.phase.toUpperCase();

                // Talon Display (shows number of cards discarded by each player)
                UI.talonP1.innerText = this.p1.discards;
                UI.talonP2.innerText = this.p2.discards;
                UI.talonP1.classList.toggle('empty', this.p1.discards === 0);
                UI.talonP2.classList.toggle('empty', this.p2.discards === 0);


                // Toggle Overlay
                if (this.phase === 'transition') {
                    UI.overlay.style.display = 'flex';
                    UI.hand.style.display = 'none';
                    UI.btns.ecarte.style.display = 'none';
                    UI.btns.declare.style.display = 'none';
                    UI.nextName.innerText = this.turn === 0 ? "Player 1" : "Player 2";
                    return;
                } 
                
                UI.overlay.style.display = 'none';
                UI.hand.style.display = 'flex';

                // Setup Phase
                if (this.phase === 'setup') {
                    UI.btns.start2p.style.display = 'inline-block';
                    UI.hand.innerHTML = '<p style="opacity:0.7">Click Start New Game</p>';
                    return;
                }
                UI.btns.start2p.style.display = 'none';

                // Controls
                UI.btns.ecarte.style.display = (this.phase === 'ecarte') ? 'inline-block' : 'none';
                UI.btns.declare.style.display = (this.phase === 'declare') ? 'inline-block' : 'none';

                // Render Hand (Active Player)
                UI.hand.innerHTML = '';
                const activeP = (this.turn === 0) ? this.p1 : this.p2;
                
                activeP.hand.forEach((card, i) => {
                    const el = renderCard(card);
                    
                    if (this.phase === 'declare') {
                        el.classList.add('disabled');
                    } else {
                        el.onclick = () => {
                            if (this.phase === 'ecarte') {
                                el.classList.toggle('selected');
                            } else if (this.phase === 'trick') {
                                game.playCard(i);
                            }
                        };
                    }
                    UI.hand.appendChild(el);
                });
            }
        }

        /* --- DOM HELPERS --- */
        function renderCard(card) {
            const div = document.createElement('div');
            div.className = 'card';
            const s = card.suit.toLowerCase();
            const sym = getSuitSymbol(card.suit);
            div.innerHTML = `<div class="rank ${s}">${card.rank}</div><div class="suit ${s}">${sym}</div><div class="center-suit ${s}">${sym}</div>`;
            return div;
        }
        function getSuitSymbol(s) {
            if(s==='Hearts') return '♥'; if(s==='Diamonds') return '♦';
            if(s==='Clubs') return '♣'; return '♠';
        }

        /* --- INIT --- */
        let game = null;

        // Start Game button now only initiates the 2P game
        UI.btns.start2p.onclick = () => { 
            // Reset scores on new game
            game = new Game(); 
            game.p1.score = 0;
            game.p2.score = 0;
            game.deal(); 
        };
        
        UI.btns.ecarte.onclick = () => {
            const idxs = [];
            document.querySelectorAll('#hand-display .card').forEach((el, i) => {
                if (el.classList.contains('selected')) idxs.push(i);
            });
            game.discard(idxs);
        };

        UI.btns.reveal.onclick = () => game.confirmReveal();
        
    </script>
</body>
</html>
